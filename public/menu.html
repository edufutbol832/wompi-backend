<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Menú Principal</title>
    <style>
        /* Mantén aquí tus estilos actuales */
    </style>
</head>
<body>
    <h1>Menú Principal</h1>
    <nav>
        <!-- Tu menú y navegación originales sin cambios -->
        <ul>
            <li><a href="#">Instructivo</a></li>
            <li><a href="#">Simulación</a></li>
            <li><a href="#">Generar Lista Pago</a></li>
            <li><a href="#">Suscripción</a></li>
        </ul>
    </nav>

    <!-- DIV para botón Wompi sin cambiar estructura -->
    <div id="wompi-button-container"></div>

    <script>
        // Variables que debes reemplazar con tus datos reales
        const PUBLIC_KEY = "pub_test_K9UBxtRMrdrjaNBNdpuqoLYxmh8feExG"; // tu clave pública Wompi
        const AMOUNT_IN_CENTS = 150000; // ejemplo: $1.500 COP (multiplicado por 100)
        const CURRENCY = "COP";
        const REFERENCE = "orden1234"; // Debe ser único para cada pago
        const CUSTOMER_EMAIL = "cliente@correo.com";

        // Función para generar firma o referencia, si usas backend debe ser desde ahí
        // Aquí solo generamos una referencia para que no esté vacía
        function generateReference() {
            // Por ejemplo, usar timestamp para referencia única
            return "orden_" + Date.now();
        }

        // Iniciar botón Wompi solo cuando el DOM esté listo
        document.addEventListener("DOMContentLoaded", function () {
            // Asigna referencia única para el pago
            const paymentReference = generateReference();

            // Validar que no esté vacía la referencia
            if (!paymentReference) {
                alert("Error: Referencia faltante para el pago");
                return;
            }

            // Crear botón Wompi usando su SDK en modo sandbox (modo pruebas)
            const wompiScript = document.createElement("script");
            wompiScript.src = "https://checkout.wompi.co/widget.js";
            wompiScript.async = true;

            wompiScript.onload = () => {
                if (!window.WompiCheckout) {
                    alert("Error: No se pudo cargar el SDK de Wompi");
                    return;
                }

                const checkout = new WompiCheckout({
                    publicKey: PUBLIC_KEY,
                    currency: CURRENCY,
                    amountInCents: AMOUNT_IN_CENTS,
                    reference: paymentReference,
                    redirectUrl: window.location.href, // Redirigir después de pago (opcional)
                    customerEmail: CUSTOMER_EMAIL,
                    onSuccess: (payment) => {
                        alert("Pago exitoso. ID: " + payment.id);
                    },
                    onError: (error) => {
                        alert("Error en pago: " + error.message);
                    },
                    onClose: () => {
                        console.log("Pago cerrado por el usuario");
                    }
                });

                // Insertar botón dentro del div existente
                checkout.render("#wompi-button-container");
            };

            document.body.appendChild(wompiScript);
        });
    </script>
</body>
</html>
